<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Templates de Local - JJK RPG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Incluindo a fonte Inter (padrão) -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0c0c1a; }
        /* Estilo para a caixa de código em linha única */
        #output-code { white-space: nowrap; overflow-x: auto; font-size: 10px; }
        .tab-content-container { max-height: 400px; overflow-y: auto; }
        .info-card-input { border-left: 4px solid #9b00ff; }
    </style>
    <script>
        // Variável global para armazenar o ID da aba ativa para o Preview
        let activeTabId = 'loc-tab-1';

        // Estrutura de dados inicial (com nomes padronizados)
        const data = {
            main: {
                title: 'Novo Local',
                bannerUrl: 'https://i.imgur.com/KB5MIUV.png', // URL de Quioto como padrão
                // O LINK CSS é fixo e não será mais editável na UI
                cssLink: 'https://gaaaaaaaaabs.github.io/goldenagerepositor.io/locais.css',
            },
            tabs: [
                { title: 'Descrição', description: '', cards: [] }, // Padrão
                { title: 'Sub-áreas', description: '', cards: [] }, // Padrão
                { title: 'Observação', description: '', cards: [] }, // Padrão
                { title: 'Missões Atuais', description: '', cards: [] } // Padrão
            ]
        };

        // --- Funções de Ajuda ---

        // Minifica o HTML removendo quebras de linha e espaços desnecessários
        function minifyHTML(html) {
            return html
                .replace(/\s+/g, ' ') // Substitui múltiplas quebras de linha/espaços por um único espaço
                .replace(/ >/g, '>')  // Remove espaços antes de >
                .replace(/ < /g, '<')  // Remove espaços depois de <
                .trim();
        }

        // Gera o HTML do card de informação (Info Card) ou Mission Callout
        function generateInfoCard(card, index, tabIndex) { 
            if (!card.title) return '';
            
            const isMission = tabIndex === 3;
            
            if (isMission) {
                // MISSION CALLOUT (loc-callout)
                // O conteúdo do Mission Callout é formatado com quebras de linha
                const contentHtml = card.content ? card.content.replace(/\n/g, '<br>') : '';
                return `
                    <div class="loc-callout">
                        <p><strong>${card.title}</strong><br>
                        ${contentHtml}</p>
                    </div>
                `;
            } else {
                // STANDARD INFO CARD (info-card)
                const linkTag = card.link ? `[url=${card.link}]${card.title}[/url]` : card.title;
                return `
                    <div class="info-card">
                        <div class="info-title">${linkTag}</div>
                        <div class="info-content">${card.content || ''}</div>
                    </div>
                `;
            }
        }
        
        // Gera o HTML do painel de uma aba
        function generateTabPanel(tab, tabIndex) {
            const paneId = `loc-pane-${tabIndex + 1}`;
            
            // Reconstroi os Info Cards (apenas cards com título)
            const infoCardsHtml = tab.cards.map((card, idx) => generateInfoCard(card, idx, tabIndex)).filter(Boolean).join('');

            // O replace da quebra de linha garante novos parágrafos no fórum
            const descriptionHtml = tab.description.split('\n').map(p => `<p>${p.trim()}</p>`).join('');
            
            // Missões Atuais (Tab 3) usam o infoCardsHtml diretamente sem o info-grid-2col para que os callouts se empilhem verticalmente.
            const isMissionTab = tabIndex === 3;
            const isDescTab = tabIndex === 0;

            // Se for Descrição, usa a descrição principal; senão, usa apenas os cards
            const contentBody = isDescTab ? descriptionHtml : '';
            
            return `
                <div class="tab-pane" id="${paneId}">
                    <div class="loc-content">
                        ${contentBody}
                        ${!isMissionTab && infoCardsHtml ? `<div class="info-grid-2col">${infoCardsHtml}</div>` : infoCardsHtml}
                    </div>
                </div>
            `;
        }

        // --- Funções de Gestão de Dados e UI ---
        
        // Renders the dynamic input fields for cards based on the current data model
        function renderInputCards(tabIndex) {
            const container = document.getElementById(`tab-${tabIndex}-cards`);
            let html = '';
            
            // Garante que o Title e Description inputs reflitam o modelo de dados
            document.getElementById(`tab-${tabIndex}-title`).value = data.tabs[tabIndex].title;
            
            const descriptionInput = document.getElementById(`tab-${tabIndex}-description`);
            if (descriptionInput) {
                descriptionInput.value = data.tabs[tabIndex].description;
            }

            // Gera Input Fields para cada Card
            data.tabs[tabIndex].cards.forEach((card, j) => {
                const isMission = tabIndex === 3;
                const titlePlaceholder = isMission ? "Título da Missão (Ex: O Som do Metrô)" : "Título (Ex: Prédio Principal)";
                const contentPlaceholder = isMission ? "Detalhes da Missão e Grau (Ex: Grau: Grau 2\nDetalhes: Três desaparecimentos...)" : "Conteúdo da descrição do card";
                
                // Remove link input para missões
                const linkInput = !isMission ? 
                    `<input type="text" id="tab-${tabIndex}-card-${j}-link" 
                        placeholder="Link de destino (Opcional: https://...)" 
                        class="w-full p-2 mb-2 text-sm bg-gray-800 border border-gray-600 rounded" 
                        value="${card.link || ''}"
                        oninput="updateCardData(${tabIndex}, ${j})">` : 
                    '';

                html += `
                    <div class="p-3 bg-gray-700 rounded-lg info-card-input shadow-inner">
                        <div class="flex justify-between items-center mb-2">
                            <h4 class="font-bold text-sm text-highlight">${isMission ? 'Missão' : 'Card de Informação'} ${j + 1}</h4>
                            <button type="button" onclick="removeCard(${tabIndex}, ${j})" class="text-red-400 hover:text-red-600 text-xs font-bold transition duration-200">
                                Remover
                            </button>
                        </div>
                        
                        <input type="text" id="tab-${tabIndex}-card-${j}-title" 
                            placeholder="${titlePlaceholder}" 
                            class="w-full p-2 mb-2 text-sm bg-gray-800 border border-gray-600 rounded" 
                            value="${card.title || ''}"
                            oninput="updateCardData(${tabIndex}, ${j})">
                        
                        ${linkInput}
                        
                        <textarea id="tab-${tabIndex}-card-${j}-content" rows="2" 
                            placeholder="${contentPlaceholder}" 
                            class="w-full p-2 text-sm bg-gray-800 border border-gray-600 rounded"
                            oninput="updateCardData(${tabIndex}, ${j})">${card.content || ''}</textarea>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Add Card Button
            const cardType = tabIndex === 3 ? 'Missão' : 'Card';
            container.innerHTML += `
                <button type="button" onclick="addCard(${tabIndex})" class="w-full p-3 bg-indigo-700 hover:bg-indigo-600 rounded-lg text-white font-bold transition duration-200 mt-4">
                    + Adicionar ${cardType}
                </button>
            `;
            
            generateTemplate();
        }

        // Adds a new card to the data model and re-renders inputs
        function addCard(tabIndex) {
            data.tabs[tabIndex].cards.push({});
            renderInputCards(tabIndex);
        }

        // Removes a card from the data model and re-renders inputs
        function removeCard(tabIndex, cardIndex) {
            data.tabs[tabIndex].cards.splice(cardIndex, 1);
            renderInputCards(tabIndex);
        }

        // Updates data model when an input changes
        function updateCardData(tabIndex, cardIndex) {
            const card = data.tabs[tabIndex].cards[cardIndex];

            card.title = document.getElementById(`tab-${tabIndex}-card-${cardIndex}-title`).value;
            
            const linkInput = document.getElementById(`tab-${tabIndex}-card-${cardIndex}-link`);
            if (linkInput) {
                card.link = linkInput.value;
            }

            card.content = document.getElementById(`tab-${tabIndex}-card-${cardIndex}-content`).value;
            
            generateTemplate();
        }

        // Função corrigida
        function updateDescription(tabIndex) {
             data.tabs[tabIndex].description = document.getElementById(`tab-${tabIndex}-description`).value;
             generateTemplate();
        }
        
        // Função corrigida
        function updateTabTitle(tabIndex) {
             data.tabs[tabIndex].title = document.getElementById(`tab-${tabIndex}-title`).value;
             generateTemplate();
        }

        // --- Função Principal de Geração ---
        function generateTemplate() {
            // 1. Capturar o ID da aba ativa ANTES de limpar o preview
            const checkedInput = document.querySelector('#preview-container input.rpg-tabs-input:checked');
            if (checkedInput) {
                activeTabId = checkedInput.id;
            }

            // 2. Coletar dados da UI (Apenas Main, Títulos e Descrições)
            data.main.title = document.getElementById('main-title').value;
            data.main.bannerUrl = document.getElementById('banner-url').value;

            // 3. Gerar o HTML
            const tabNavLabels = data.tabs.map((tab, i) => `<label class="tab-button" for="loc-tab-${i + 1}">${tab.title}</label>`).join('');
            const tabPanelsHtml = data.tabs.map((tab, i) => generateTabPanel(tab, i)).join('');

            const templateHtml = `
                <link href="${data.main.cssLink}" rel="stylesheet" type="text/css">
                <div class="loc-container">
                    <div class="loc-banner" style="background-image: url('${data.main.bannerUrl}');">
                        <h2 class="loc-title">${data.main.title}</h2>
                    </div>
                    <div class="loc-body">
                        <div class="rpg-tabs">
                            <input type="radio" name="loc-tabs" id="loc-tab-1" class="rpg-tabs-input" ${activeTabId === 'loc-tab-1' ? 'checked' : ''}>
                            <input type="radio" name="loc-tabs" id="loc-tab-2" class="rpg-tabs-input" ${activeTabId === 'loc-tab-2' ? 'checked' : ''}>
                            <input type="radio" name="loc-tabs" id="loc-tab-3" class="rpg-tabs-input" ${activeTabId === 'loc-tab-3' ? 'checked' : ''}>
                            <input type="radio" name="loc-tabs" id="loc-tab-4" class="rpg-tabs-input" ${activeTabId === 'loc-tab-4' ? 'checked' : ''}>
                            <div class="tab-nav">
                                ${tabNavLabels}
                            </div>
                            <div class="tab-pane-wrapper">
                                ${tabPanelsHtml}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // 4. Minificar o HTML
            const minifiedHtml = minifyHTML(templateHtml);

            // 5. Atualizar UI
            document.getElementById('output-code').value = minifiedHtml;
            document.getElementById('preview-container').innerHTML = templateHtml;

            // 6. Configurar listeners de clique nas abas do preview para preservar o estado
            document.querySelectorAll('#preview-container .rpg-tabs-input').forEach(input => {
                input.addEventListener('change', (event) => {
                    if (event.target.checked) {
                        activeTabId = event.target.id;
                    }
                });
            });
        }

        // --- Funções de Inicialização de UI ---

        function copyToClipboard() {
            const output = document.getElementById('output-code');
            output.select();
            document.execCommand('copy');
            const button = document.getElementById('copy-button');
            button.textContent = 'Copiado!';
            setTimeout(() => {
                button.textContent = 'Copiar Código';
            }, 2000);
        }

        function setupTabSwitching(tabCount) {
            const tabsContainer = document.getElementById('generator-tabs-container');
            const tabButtons = tabsContainer.querySelectorAll('button[data-tab]');
            
            const initialTab = document.getElementById('tab-0-button');
            showTabContent('tab-0');
            initialTab.classList.add('bg-indigo-700', 'text-white');
            
            tabButtons.forEach((button, i) => {
                button.addEventListener('click', () => {
                    const targetTab = button.getAttribute('data-tab');

                    tabButtons.forEach(btn => btn.classList.remove('bg-indigo-700', 'text-white'));
                    showTabContent(targetTab);
                    button.classList.add('bg-indigo-700', 'text-white');
                });
            });
        }
        
        function showTabContent(tabId) {
            document.querySelectorAll('[data-tab-content]').forEach(content => {
                content.classList.add('hidden');
            });
            const content = document.getElementById(tabId + '-content');
            if (content) {
                content.classList.remove('hidden');
            }
        }

        // Inicialização
        window.onload = function() {
            // Inicializa a aba principal
            setupTabSwitching(5); 
            
            // --- Inicialização de Dados de Exemplo ---
            data.main.title = "Escola de Jujutsu de Tóquio";
            data.main.bannerUrl = "https://i.pinimg.com/originals/a3/5d/01/a35d01bde94164b835342a973f7d4658.jpg";
            
            // ABA 0: DESCRIÇÃO
            data.tabs[0].title = "Descrição";
            data.tabs[0].description = "Este é o local principal. Descreva o ambiente, a atmosfera e o nível de risco Jujutsu. Use quebras de linha para novos parágrafos.";
            data.tabs[0].cards = [
                { title: "Nível de Risco", content: "Alto (Presença de Grau Especial)", link: "" }
            ];

            // ABA 1: SUB-ÁREAS
            data.tabs[1].title = "Sub-áreas";
            data.tabs[1].description = ""; // Descrição removida
            data.tabs[1].cards = [
                { title: "Prédio Principal", content: "Onde ocorrem as aulas teóricas.", link: "" },
                { title: "Dormitórios", content: "Alojamentos para os estudantes.", link: "" }
            ];

            // ABA 2: OBSERVAÇÃO
            data.tabs[2].title = "Observação";
            data.tabs[2].description = ""; // Descrição removida
            data.tabs[2].cards = [
                 { title: "Satoru Gojo", content: "Professor do 1º Ano e o Feiticeiro mais forte.", link: "" }
            ];

            // ABA 3: MISSÕES
            data.tabs[3].title = "Missões Atuais";
            data.tabs[3].description = ""; // Descrição removida
            data.tabs[3].cards = [
                 { title: "MISSÃO: O Som do Metrô", content: "Grau: Grau 2\nDetalhes: Três desaparecimentos na linha Ginza. Investigar os túneis e exorcizar a fonte.", link: "" }
            ];


            // Renderiza o input cards da aba ativa (0)
            renderInputCards(0);

            // Adiciona listeners para os campos de Título e Descrição de todas as abas
            for(let i=0; i<4; i++){
                document.getElementById(`tab-${i}-title`).addEventListener('input', () => updateTabTitle(i));
            }

            // Atualiza listeners para Descrição, que só existe na ABA 0
            document.getElementById('tab-0-description').addEventListener('input', () => updateDescription(0));


            // Adiciona listeners aos botões das abas para que renderizem os inputs corretos
            document.querySelectorAll('#generator-tabs-container button[data-tab]').forEach((button, i) => {
                button.addEventListener('click', () => {
                    renderInputCards(i);
                });
            });
            
            generateTemplate();
        };
    </script>
</head>
<body class="text-white">
    <div class="max-w-7xl mx-auto p-4 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-highlight mb-2">Gerador de Templates de Local (JJK)</h1>
            <p class="text-muted text-sm">Preencha os dados e copie o código HTML final.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Coluna de Input e Configurações (Ocupa 1/3 da largura) -->
            <div class="lg:col-span-1 space-y-6">
                
                <!-- Configurações Principais -->
                <div class="bg-panel p-5 rounded-xl shadow-lg border border-gray-700">
                    <h2 class="text-xl font-bold text-highlight mb-4 border-b border-gray-700 pb-2">Configurações Gerais</h2>
                    <div class="space-y-4">
                        <label class="block">Título do Local:</label>
                        <input type="text" id="main-title" class="w-full p-3 bg-gray-800 border border-gray-700 rounded" oninput="generateTemplate()">
                        
                        <label class="block">URL da Imagem do Banner:</label>
                        <input type="text" id="banner-url" class="w-full p-3 bg-gray-800 border border-gray-700 rounded" oninput="generateTemplate()">
                    </div>
                </div>

                <!-- Abas de Conteúdo do Template -->
                <div class="bg-panel p-5 rounded-xl shadow-lg border border-gray-700">
                    <h2 class="text-xl font-bold text-highlight mb-4 border-b border-gray-700 pb-2">Conteúdo das Abas</h2>
                    
                    <!-- Navegação das Abas de Input -->
                    <div id="generator-tabs-container">
                        <div class="flex flex-wrap gap-2 mb-4 p-1 bg-gray-800 rounded-lg">
                            <button id="tab-0-button" data-tab="tab-0" class="p-2 rounded transition duration-200 text-sm">Descrição</button>
                            <button data-tab="tab-1" class="p-2 rounded transition duration-200 text-sm">Sub-áreas</button>
                            <button data-tab="tab-2" class="p-2 rounded transition duration-200 text-sm">Observação</button>
                            <button data-tab="tab-3" class="p-2 rounded transition duration-200 text-sm">Missões Atuais</button>
                        </div>

                        <!-- Conteúdo da Aba 1 (Descrição) -->
                        <div id="tab-0-content" data-tab-content class="space-y-4 tab-content-container">
                            <h3 class="font-bold text-lg text-highlight">Configuração da Descrição</h3>
                            <input type="text" id="tab-0-title" placeholder="Título da Aba (Padrão: Descrição)" class="w-full p-2 bg-gray-800 border border-gray-600 rounded" oninput="updateTabTitle(0)">
                            <textarea id="tab-0-description" rows="4" placeholder="Descrição Principal da Aba 1 (Use quebras de linha para novos parágrafos)" class="w-full p-2 bg-gray-800 border border-gray-600 rounded" oninput="updateDescription(0)"></textarea>
                            <div id="tab-0-cards" class="space-y-3"></div>
                        </div>

                        <!-- Conteúdo da Aba 2 (Sub-áreas) - SEM TEXTAREA -->
                        <div id="tab-1-content" data-tab-content class="space-y-4 hidden tab-content-container">
                            <h3 class="font-bold text-lg text-highlight">Configuração das Sub-áreas</h3>
                            <input type="text" id="tab-1-title" placeholder="Título da Aba (Padrão: Sub-áreas)" class="w-full p-2 bg-gray-800 border border-gray-600 rounded" oninput="updateTabTitle(1)">
                            <!-- <textarea> removida -->
                            <div id="tab-1-cards" class="space-y-3"></div>
                        </div>

                        <!-- Conteúdo da Aba 3 (Observação) - SEM TEXTAREA -->
                        <div id="tab-2-content" data-tab-content class="space-y-4 hidden tab-content-container">
                            <h3 class="font-bold text-lg text-highlight">Configuração da Observação</h3>
                            <input type="text" id="tab-2-title" placeholder="Título da Aba (Padrão: Observação)" class="w-full p-2 bg-gray-800 border border-gray-600 rounded" oninput="updateTabTitle(2)">
                            <!-- <textarea> removida -->
                            <div id="tab-2-cards" class="space-y-3"></div>
                        </div>

                        <!-- Conteúdo da Aba 4 (Missões Atuais) - SEM TEXTAREA -->
                        <div id="tab-3-content" data-tab-content class="space-y-4 hidden tab-content-container">
                            <h3 class="font-bold text-lg text-highlight">Configuração das Missões Atuais</h3>
                            <input type="text" id="tab-3-title" placeholder="Título da Aba (Padrão: Missões Atuais)" class="w-full p-2 bg-gray-800 border border-gray-600 rounded" oninput="updateTabTitle(3)">
                            <!-- <textarea> removida -->
                            <div id="tab-3-cards" class="space-y-3"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Coluna de Preview e Saída (Ocupa 2/3 da largura) -->
            <div class="lg:col-span-2 space-y-6"> 
                
                <!-- Preview em Tempo Real -->
                <div class="p-5 bg-panel rounded-xl shadow-lg border border-gray-700">
                    <h2 class="text-xl font-bold text-highlight mb-4 border-b border-gray-700 pb-2">Preview</h2>
                    <div id="preview-container" class="bg-gray-900 p-2 rounded-lg" style="max-height: 500px; overflow-y: auto;">
                        <!-- O template será injetado aqui -->
                    </div>
                </div>

                <!-- Saída e Botão Copiar -->
                <div class="p-5 bg-panel rounded-xl shadow-lg border border-gray-700">
                    <h2 class="text-xl font-bold text-highlight mb-4 border-b border-gray-700 pb-2">Código Final</h2>
                    <button id="copy-button" onclick="copyToClipboard()" class="w-full p-3 mb-3 bg-indigo-700 hover:bg-indigo-600 rounded-lg font-bold transition duration-200">
                        Copiar Código
                    </button>
                    <textarea id="output-code" rows="10" readonly class="w-full p-3 bg-gray-800 border border-gray-700 rounded text-muted cursor-copy"></textarea>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
